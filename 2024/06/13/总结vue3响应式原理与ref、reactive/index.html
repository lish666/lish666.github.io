
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title> | 木子的博客</title>
    <meta name="author" content="lish" />
    <meta name="description" content="--是木子呀" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="木子的博客" type="application/atom+xml">
</head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>木子的博客</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;木子的博客</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1></h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/6/13
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>vue2的响应式通过Object.defineProperty将data转为响应式，而vue3则通过Proxy实现，性能得到显著提升，那么vue3的响应式系统做了什么呢？发生了哪些变化？</p>
<h3 id="vue3通过什么api实现响应式数据声明，怎么实现？"><a href="#vue3通过什么api实现响应式数据声明，怎么实现？" class="headerlink" title="vue3通过什么api实现响应式数据声明，怎么实现？"></a>vue3通过什么api实现响应式数据声明，怎么实现？</h3><p>对比vue2，响应式数据都声明在<code>data()&#123;&#125;</code>中，但是vue3则需要我们通过api自己声明，如下就是声明vue3响应式的代码。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;想吃炸鸡&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> obj = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&quot;深圳不怕影子斜&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj,msg);</span><br><span class="line">    <span class="keyword">return</span> &#123; msg,obj &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>看完这个案例之后，是不是想了解怎么实现一个简单的响应式数据结构和理解他的原理呢？</p>
<h4 id="第一步：实现一个简单的reactive"><a href="#第一步：实现一个简单的reactive" class="headerlink" title="第一步：实现一个简单的reactive"></a>第一步：实现一个简单的reactive</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reactive = <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    <span class="comment">//返回劫持obj的Proxy对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">        <span class="comment">//劫持get</span></span><br><span class="line">        <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//劫持set</span></span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">            target[key] = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//声明一个reactive</span></span><br><span class="line"><span class="keyword">let</span> reactive_data = <span class="title function_">reactive</span>(&#123;<span class="attr">age</span>:<span class="number">30</span>&#125;)</span><br><span class="line">a.<span class="property">age</span> = <span class="number">40</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">age</span>)</span><br></pre></td></tr></table></figure>
<p>接下来我们可以看到我们修改了值改成了40，我的reactive方法通过Proxy劫持对象，实现了一个简单的响应式方法，这就是Vue 3 使用了 Proxy 来创建响应式对象的原理，当然vue3考虑的会更全面，我们这只是一个简单的案例，理解他怎么实现的。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8f2aa768d5b475e81d6c6f99f2bba46~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=250&h=166&s=16823&e=jpg&b=fefefe" alt="01.png"></p>
<h4 id="既然有了reactive-为什么还会有ref呢？"><a href="#既然有了reactive-为什么还会有ref呢？" class="headerlink" title="既然有了reactive,为什么还会有ref呢？"></a>既然有了reactive,为什么还会有ref呢？</h4><p>接下来我们看一段代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="title function_">reactive</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印A&#x27;</span>,obj);</span><br><span class="line">  obj++</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印B&#x27;</span>,obj);</span><br><span class="line">  <span class="keyword">return</span> &#123; obj &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ba93320344444089f28396b804f0fe0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=850&h=220&s=21235&e=png&b=fef2e5" alt="image.png"><br>再看上面控制台打印的，你会发现通过reactive直接声明number,string,boolean等值类型的响应式数据，是不支持的，直接提示了错误，原因是Proxy只能劫持对象，那我们需要写成下面这样,打印结果正常了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="title function_">reactive</span>(&#123;<span class="attr">value</span>:<span class="number">1</span>&#125;)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印A&#x27;</span>,obj)</span><br><span class="line">  obj.<span class="property">value</span>++</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印B&#x27;</span>,obj)</span><br><span class="line">  <span class="keyword">return</span> &#123; obj &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69447c1021144132a976d4c50848f355~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=400&h=78&s=7171&e=png&b=fffefe" alt="image.png"></p>
<h4 id="第二步-先实现一个简单的ref"><a href="#第二步-先实现一个简单的ref" class="headerlink" title="第二步:先实现一个简单的ref"></a>第二步:先实现一个简单的ref</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> refObject = &#123;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">          <span class="keyword">return</span> value</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">          value = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> refObject</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//声明响应式</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="title function_">ref</span>(<span class="number">18</span>)</span><br><span class="line"><span class="comment">//打印出18</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ref&#x27;</span>,age.<span class="property">value</span>)</span><br><span class="line"><span class="comment">//赋值加1</span></span><br><span class="line">age.<span class="property">value</span> ++</span><br><span class="line"><span class="comment">//打印出19</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ref&#x27;</span>,age.<span class="property">value</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1d47b6d343e4070bdfb46b58480d845~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=195&h=67&s=1403&e=png&b=ffffff" alt="image.png"></p>
<p>通过上面这个案例，我们去传入一个对象时，发现又报错了，如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ref = <span class="title function_">ref</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;小明&quot;</span>,<span class="attr">age</span>:<span class="number">18</span>&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ref&#x27;</span>,refa.<span class="property">value</span>.<span class="property">age</span>);</span><br><span class="line">refa.<span class="property">value</span>.<span class="property">age</span> ++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ref&#x27;</span>,refa.<span class="property">value</span>.<span class="property">age</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/683d9ec0c37c456d83fede7a4feee1f6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=849&h=241&s=25941&e=png&b=fef5d7" alt="image.png"></p>
<p>这是因为，真正的ref是通过RefImpl类实现的时候，在构造器和set参数时动态的判断了是否是object对象，如果是则通过reactive实现，那么我们按照他的思路写一个简单的案例，继续改造一下我们的ref</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;age_click()&quot;</span>&gt;</span>点我增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//首先简单的实现一下isObject</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">isObject</span> = (<span class="params">value</span>)=&gt; <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//第二步实现toReactive，是否为对象，如果是则调用之前写好的reactive方法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">toReactive</span> = (<span class="params">value</span>) =&gt; <span class="title function_">isObject</span>(value) ? <span class="title function_">reactive</span>(value) : value</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//第三步实现一下RefImpl</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">class</span> <span class="title class_">RefImpl</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    _value =<span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//在这里初始化值，真实的RefImpl类构造器里面还初始化了很多东西</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">isObject</span>(value) ? <span class="title function_">toReactive</span>(value) : value;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123; <span class="comment">// getter方法 获取value值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get了&#x27;</span>,<span class="variable language_">this</span>.<span class="property">_value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123; <span class="comment">// setter方法 设置value值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">isObject</span>(newVal) ?  <span class="title function_">toReactive</span>(newVal):newVal;  <span class="comment">// 判断是否为object，是则调用toReactive</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set了&#x27;</span>,newVal);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//那么我们的ref就可以简化如下了</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> ref =<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RefImpl</span>(value)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> obj = <span class="title function_">ref</span>(&#123;<span class="attr">age</span>:<span class="number">18</span>&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title function_">age_click</span> =(<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;对象的age&#x27;</span>,obj.<span class="property">value</span>.<span class="property">age</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    obj.<span class="property">value</span>.<span class="property">age</span> ++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;对象的age&#x27;</span>,obj.<span class="property">value</span>.<span class="property">age</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这个时候我们能看到的结果如下，至此，ref实现了可以传入对象进行响应式的操作。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a088cdb3280f42b693fc3dcd246f5e9c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=516&h=177&s=14155&e=png&b=fffefe" alt="image.png"></p>
<h3 id="实现了数据响应，怎么实现数据变了页面也跟着变？"><a href="#实现了数据响应，怎么实现数据变了页面也跟着变？" class="headerlink" title="实现了数据响应，怎么实现数据变了页面也跟着变？"></a>实现了数据响应，怎么实现数据变了页面也跟着变？</h3><p>我们上面虽然实现了数据的响应，可是他什么时候会更新呢？这个就涉及到vue的track和trigger，我们劫持了数据的get和set，在get的时候track收集依赖（发布订阅），在set的时候触发trigger（通知订阅）的update进行更新。思路有了那我们来写一个简单的案例理解一下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;age_click()&quot;</span>&gt;</span>点我增加年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> &gt;</span>我的age现在是<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;update_span&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 首先先将activeWatcher设为null 确保在初始化阶段没有活动的Watcher对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> activeWatcher = <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 创建 Watcher 类，通过构造函数绑定update函数，并实现update更新回调</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params">updateFn</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">updateFn</span> = updateFn;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 执行更新操作</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="title function_">updateFn</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//创建更新操作方法，更新页面数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title function_">update</span> = (<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新页面元素开始&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#update_span&quot;</span>).<span class="property">innerHTML</span> = age.<span class="property">value</span>.<span class="property">age</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新页面元素结束&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//实例化一个Watcher</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">activeWatcher = <span class="keyword">new</span> <span class="title class_">Watcher</span>(update)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 创建依赖管理类Dep，通过构造函数初始化依赖收集器，实现track收集依赖</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 用于存储依赖的订阅者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">subscribers</span> = <span class="keyword">new</span> <span class="title class_">Set</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 添加订阅者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    track=<span class="function">(<span class="params">key</span>) =&gt;</span>  activeWatcher &amp;&amp; <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">add</span>(activeWatcher)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 通知所有订阅者进行更新</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    trigger=<span class="function">()=&gt;</span> <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">watcher</span>) =&gt;</span> watcher.<span class="title function_">update</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//new 一个依赖收集器</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//基于上面的reactive方法，添加了dep.track() //发布订阅和dep.trigger() //通知订阅</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> reactive = <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// track(target, key)//vue的发布订阅</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            dep.<span class="title function_">track</span>() <span class="comment">//发布订阅</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// return Reflect.get(target,key) </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> target[key]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set了&#x27;</span>,value);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            target[key] = value</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// vue3底层的对象响应式的雏形是这样的，利用proxy代理，利用reflect反射</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// Reflect.set(target,key,value)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// trigger(target, key)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            dep.<span class="title function_">trigger</span>() <span class="comment">//通知订阅</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//简单的实现isObject</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title function_">isObject</span> = (<span class="params">value</span>)=&gt; <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 是否为对象，如果是则调用reactive</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">toReactive</span> = (<span class="params">value</span>) =&gt; &#123;<span class="keyword">return</span> <span class="title function_">isObject</span>(value) ? <span class="title function_">reactive</span>(value) : value&#125;; </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//根据上面的RefImpl，添加dep.track()和dep.trigger()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">class</span> <span class="title class_">RefImpl</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    _value =<span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//在这里初始化值，真实的RefImpl类构造器里面还初始化了很多东西</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">isObject</span>(value) ? <span class="title function_">toReactive</span>(value) : value;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123; <span class="comment">// getter方法 获取value值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        dep.<span class="title function_">track</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get了&#x27;</span>,<span class="variable language_">this</span>.<span class="property">_value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123; <span class="comment">// setter方法 设置value值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">_value</span> = <span class="title function_">isObject</span>(newVal) ?  <span class="title function_">toReactive</span>(newVal):newVal;  <span class="comment">// 判断是否为object，是则调用toReactive</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set了&#x27;</span>,newVal);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        dep.<span class="title function_">trigger</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//实现ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> ref =<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RefImpl</span>(value)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//声明一个ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> age = <span class="title function_">ref</span>(&#123;<span class="attr">age</span>:<span class="number">18</span>,<span class="attr">name</span>:<span class="string">&#x27;aaa&#x27;</span>&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//实现click</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title function_">age_click</span> =(<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    age.<span class="property">value</span>.<span class="property">age</span>++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//把值初始化挂载在页面</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">update</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这个时候我们看到了初始化把age挂载在页面上的效果，模拟成功</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6560dad57401416f91c9b469fd8a3e9b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=577&h=543&s=29355&e=png&b=fefefe" alt="image.png"><br>再看看点击一下按钮之后的效果</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5eb3e672c1714b3bb67c34743991746a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=582&h=721&s=44729&e=png&b=fefefe" alt="image.png"><br>至此，模拟成功，这个是一个简单的例子，来帮助我们理解响应式的原理，实际的vue发布订阅以及响应更新页面元素会更复杂。</p>
<h3 id="ref和reactive的注意事项"><a href="#ref和reactive的注意事项" class="headerlink" title="ref和reactive的注意事项"></a>ref和reactive的注意事项</h3><ul>
<li>reactive() 返回的是一个原始对象的 Proxy，它和原始对象是不相等的<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> raw = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="title function_">reactive</span>(raw)</span><br><span class="line"><span class="comment">// 代理对象和原始对象不是全等的</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy === raw) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li>
<li>只有代理对象是响应式的，更改原始对象不会触发更新。因此，使用 Vue 的响应式系统的最佳实践是<strong>仅使用你声明对象的代理版本</strong><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> raw = &#123;<span class="attr">age</span>:<span class="number">18</span>&#125;<span class="comment">//非响应式数据</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="title function_">reactive</span>(raw)<span class="comment">//响应式数据</span></span><br><span class="line">raw.<span class="property">age</span> =<span class="number">19</span>  <span class="comment">//不会触发页面更新</span></span><br><span class="line">proxy.<span class="property">age</span> =<span class="number">19</span> <span class="comment">//会触发页面更新</span></span><br></pre></td></tr></table></figure></li>
<li>reactive使用时不能替换整个对象：由于 Vue 的响应式跟踪是通过属性访问实现的，因此我们必须始终保持对响应式对象的相同引用。<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="comment">// 上面的 (&#123; count: 0 &#125;) 引用将不再被追踪</span></span><br><span class="line"><span class="comment">// (响应性连接已丢失！)</span></span><br><span class="line">state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li>reactive对解构操作不友好：当我们将响应式对象的原始类型属性解构为本地变量时，或者将该属性传递给函数时，我们将丢失响应性连接，在对象需要解构的时候，建议配合<code>toRefs</code>使用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;) </span><br><span class="line"><span class="comment">// 当解构时，count 已经与 state.count 断开连接 </span></span><br><span class="line"><span class="keyword">let</span> &#123; count &#125; = state </span><br><span class="line"><span class="comment">// 不会影响原始的 </span></span><br><span class="line">state count++ </span><br><span class="line"><span class="comment">// 该函数接收到的是一个普通的数字 </span></span><br><span class="line"><span class="comment">// 并且无法追踪 state.count 的变化 // 我们必须传入整个对象以保持响应性 callSomeFunction(state.count)</span></span><br><span class="line"><span class="comment">//基于这个问题所以官方建议我们使用ref</span></span><br></pre></td></tr></table></figure></li>
<li>额外的 ref 解包细节<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>) </span><br><span class="line"><span class="comment">//一个 ref 会在作为响应式对象的属性被访问或修改时自动解包,count在reactive中被解包</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; count &#125;)</span><br><span class="line"><span class="comment">//只有当嵌套在一个深层响应式对象内时，才会发生 ref 解包。当其作为shallowReactiv浅层响应式的属性被访问时不会解包</span></span><br><span class="line"><span class="comment">//如果将一个新的 ref 赋值给一个关联了已有 ref 的属性，那么它会替换掉旧的 ref</span></span><br><span class="line"><span class="comment">//当 ref 作为响应式数组或原生集合类型 (如 `Map`) 中的元素被访问时，它不会被解包</span></span><br><span class="line"><span class="comment">//ref在template模板中可以自动解包</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>上次在博客上看说vue3的响应式底层使用到了Reflect工具类，所以我去看了一下，这篇文章写的不错推荐给大家一起看看，这篇文章讲述了Proxy和Reflect,并且描述了通过劫持对象的get或者set方法实现表单校验和请求拦截，扩展了我的编程思路。<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/9Ve7iidl4V8I_Of3ek2EDQ">揭秘：Proxy 与 Reflect，为何总是形影不离</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>ref判断了对象是原始类型还是object，是object则通过reactive new Proxy后再赋值给value，否则直接赋值给value,ref支持声明number，布尔等原始类型的值和对象的响应式数据</li>
<li>reactive只支持声明object响应式数据，返回的是一个Proxy代理对象</li>
<li>通过Weak容器，实现观察者角色，ref和reactive都实现了通过get的track收集依赖到容器和set参数的trigger触发容易中的依赖的更新，下面是vue官方的一段话。</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33bc34be57064e6585425a5bac7953d9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1033&h=324&s=60515&e=png&b=fefefe" alt="image.png"></p>
<p>最后，如果有写的不好的，欢迎大家指点。</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 木子的博客
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;lish
        </div>
        <!-- <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div> -->
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
